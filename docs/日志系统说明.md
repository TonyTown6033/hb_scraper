# æ—¥å¿—ç³»ç»Ÿè¯´æ˜

## ğŸ“‹ æ¦‚è¿°

é¡¹ç›®é›†æˆäº†å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿï¼Œç”¨äºè®°å½•çˆ¬è™«è¿è¡Œè¿‡ç¨‹ã€è°ƒè¯•ä¿¡æ¯å’Œé”™è¯¯è¿½è¸ªã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

### 1. å¤šçº§åˆ«æ—¥å¿—
- **DEBUG** - è°ƒè¯•ä¿¡æ¯ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
- **INFO** - ä¸€èˆ¬ä¿¡æ¯ï¼ˆæ­£å¸¸æµç¨‹ï¼‰
- **WARNING** - è­¦å‘Šä¿¡æ¯ï¼ˆéœ€è¦æ³¨æ„ï¼‰
- **ERROR** - é”™è¯¯ä¿¡æ¯ï¼ˆæœ‰é—®é¢˜ä½†å¯ç»§ç»­ï¼‰
- **CRITICAL** - ä¸¥é‡é”™è¯¯ï¼ˆç³»ç»Ÿæ— æ³•ç»§ç»­ï¼‰

### 2. å¤šè¾“å‡ºæ–¹å¼
- **æ§åˆ¶å°è¾“å‡º** - å½©è‰²æ˜¾ç¤ºï¼Œæ–¹ä¾¿å®æ—¶æŸ¥çœ‹
- **æ–‡ä»¶è¾“å‡º** - è¯¦ç»†è®°å½•åˆ°æ–‡ä»¶
- **æ¯æ—¥æ—¥å¿—** - æŒ‰æ—¥æœŸåˆ†ç¦»æ—¥å¿—æ–‡ä»¶
- **é”™è¯¯æ—¥å¿—** - é”™è¯¯å•ç‹¬è®°å½•

### 3. è‡ªåŠ¨ç®¡ç†
- **è‡ªåŠ¨è½®è½¬** - æ—¥å¿—æ–‡ä»¶è¾¾åˆ°10MBè‡ªåŠ¨åˆ†å‰²
- **ä¿ç•™å¤‡ä»½** - ä¿ç•™æœ€è¿‘5ä¸ªå¤‡ä»½æ–‡ä»¶
- **å½©è‰²è¾“å‡º** - ç»ˆç«¯è‡ªåŠ¨è¯†åˆ«æ”¯æŒå½©è‰²
- **å¼‚å¸¸è¿½è¸ª** - è‡ªåŠ¨è®°å½•å®Œæ•´å †æ ˆä¿¡æ¯

## ğŸ“ æ—¥å¿—æ–‡ä»¶

### æ–‡ä»¶ä½ç½®
æ‰€æœ‰æ—¥å¿—ä¿å­˜åœ¨ `logs/` ç›®å½•ä¸‹ï¼š

```
logs/
â”œâ”€â”€ scraper.log              # ä¸»æ—¥å¿—æ–‡ä»¶ï¼ˆè½®è½¬ï¼‰
â”œâ”€â”€ scraper.log.1            # å¤‡ä»½1
â”œâ”€â”€ scraper.log.2            # å¤‡ä»½2
â”œâ”€â”€ scraper_20251115.log     # ä»Šæ—¥æ—¥å¿—
â”œâ”€â”€ scraper_error.log        # é”™è¯¯æ—¥å¿—
â””â”€â”€ scraper_error.log.1      # é”™è¯¯å¤‡ä»½
```

### æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | çº§åˆ« | è¯´æ˜ |
|------|------|------|
| `scraper.log` | DEBUG+ | ä¸»æ—¥å¿—ï¼ŒåŒ…å«æ‰€æœ‰ä¿¡æ¯ |
| `scraper_YYYYMMDD.log` | INFO+ | æ¯æ—¥æ—¥å¿—ï¼Œåªè®°å½•é‡è¦ä¿¡æ¯ |
| `scraper_error.log` | ERROR+ | é”™è¯¯æ—¥å¿—ï¼Œåªè®°å½•é”™è¯¯å’Œå¼‚å¸¸ |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ 1: åœ¨ä¸»ç¨‹åºä¸­ä½¿ç”¨

```python
from utils.logger import setup_logger, get_logger
import logging

# åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿï¼ˆåªéœ€ä¸€æ¬¡ï¼‰
setup_logger(
    name="scraper",
    log_dir="logs",
    console_level=logging.INFO,  # æ§åˆ¶å°æ˜¾ç¤º INFO åŠä»¥ä¸Š
    file_level=logging.DEBUG,    # æ–‡ä»¶è®°å½•æ‰€æœ‰çº§åˆ«
    enable_color=True            # å¯ç”¨å½©è‰²è¾“å‡º
)

# è·å–loggerå¹¶ä½¿ç”¨
logger = get_logger()

logger.debug("è°ƒè¯•ä¿¡æ¯")
logger.info("ä¸€èˆ¬ä¿¡æ¯")
logger.warning("è­¦å‘Šä¿¡æ¯")
logger.error("é”™è¯¯ä¿¡æ¯")
logger.exception("å¼‚å¸¸ä¿¡æ¯ï¼ˆè‡ªåŠ¨åŒ…å«å †æ ˆï¼‰")
```

### æ–¹å¼ 2: ä½¿ç”¨ä¾¿æ·å‡½æ•°

```python
from utils import logger

logger.info("å¿«é€Ÿè®°å½•ä¿¡æ¯")
logger.error("å¿«é€Ÿè®°å½•é”™è¯¯")
```

### æ–¹å¼ 3: åœ¨è„šæœ¬ä¸­ä½¿ç”¨

```python
# åœ¨ main.py å¼€å§‹å¤„
from utils.logger import setup_logger
import logging

# è®¾ç½®æ—¥å¿—çº§åˆ«
# DEBUG - å¼€å‘è°ƒè¯•
# INFO  - æ­£å¸¸è¿è¡Œ
setup_logger(console_level=logging.INFO)
```

## ğŸ› ï¸ æ—¥å¿—æŸ¥çœ‹å·¥å…·

### åŸºæœ¬å‘½ä»¤

```bash
# åˆ—å‡ºæ‰€æœ‰æ—¥å¿—æ–‡ä»¶
python scripts/view_logs.py list

# æŸ¥çœ‹æœ€æ–°50è¡Œæ—¥å¿—
python scripts/view_logs.py view

# æŸ¥çœ‹æœ€æ–°100è¡Œ
python scripts/view_logs.py view -n 100

# åªçœ‹é”™è¯¯æ—¥å¿—
python scripts/view_logs.py view -l ERROR

# æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶
python scripts/view_logs.py view -f scraper_error.log

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
python scripts/view_logs.py tail

# æœç´¢å…³é”®è¯
python scripts/view_logs.py search -k "äº§å“"
```

### é«˜çº§ç”¨æ³•

```bash
# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
python scripts/view_logs.py view -f scraper_20251115.log

# åªçœ‹è­¦å‘Šå’Œé”™è¯¯
python scripts/view_logs.py view -l WARNING

# æœç´¢ç‰¹å®šé”™è¯¯
python scripts/view_logs.py search -k "Exception"

# å®æ—¶è·Ÿè¸ªå¹¶è¿‡æ»¤
python scripts/view_logs.py tail | grep ERROR
```

## ğŸ“– æ—¥å¿—æ ¼å¼

### æ§åˆ¶å°è¾“å‡ºæ ¼å¼
```
INFO | è®¿é—®é¡µé¢: https://example.com
```

### æ–‡ä»¶è¾“å‡ºæ ¼å¼
```
2025-11-15 18:00:00 | INFO     | scraper:45 | è®¿é—®é¡µé¢: https://example.com
```

### é”™è¯¯æ—¥å¿—æ ¼å¼
```
2025-11-15 18:00:00 | ERROR    | scraper:120 | handle_error
å‘ç”Ÿé”™è¯¯: ç½‘ç»œè¿æ¥è¶…æ—¶
Traceback (most recent call last):
  File "main.py", line 120, in handle_error
    ...
```

## ğŸ¨ æ—¥å¿—çº§åˆ«ä½¿ç”¨å»ºè®®

### DEBUG - è°ƒè¯•ä¿¡æ¯
```python
logger.debug("å½“å‰é¡µç : 3")
logger.debug(f"äº§å“è¯¦æƒ…: {product_data}")
logger.debug("å¼€å§‹å¤„ç† Cookie å¼¹çª—")
```

**ä½¿ç”¨åœºæ™¯**:
- è¯¦ç»†çš„æ‰§è¡Œæµç¨‹
- å˜é‡çš„å€¼
- å‡½æ•°è°ƒç”¨å‚æ•°
- å¾ªç¯è®¡æ•°å™¨

### INFO - ä¸€èˆ¬ä¿¡æ¯
```python
logger.info("âœ“ å·²æ¥å— Cookie")
logger.info("âœ“ æ‰¾åˆ° 20 ä¸ªäº§å“")
logger.info(f"æˆåŠŸçˆ¬å– {count} ä¸ªäº§å“")
```

**ä½¿ç”¨åœºæ™¯**:
- é‡è¦çš„æ“ä½œæ­¥éª¤
- æˆåŠŸå®Œæˆçš„ä»»åŠ¡
- ç»Ÿè®¡ä¿¡æ¯
- è¿›åº¦æç¤º

### WARNING - è­¦å‘Šä¿¡æ¯
```python
logger.warning("äº§å“ç¼ºå°‘ä»·æ ¼ä¿¡æ¯")
logger.warning("æœªæ‰¾åˆ°ä¸‹ä¸€é¡µæŒ‰é’®")
logger.warning(f"é‡è¯• {retry_count} æ¬¡åå¤±è´¥")
```

**ä½¿ç”¨åœºæ™¯**:
- éè‡´å‘½é”™è¯¯
- ç¼ºå¤±çš„å¯é€‰æ•°æ®
- é™çº§å¤„ç†
- éœ€è¦æ³¨æ„çš„æƒ…å†µ

### ERROR - é”™è¯¯ä¿¡æ¯
```python
logger.error("âœ— é¡µé¢åŠ è½½å¤±è´¥")
logger.error(f"æå–äº§å“ {idx} å¤±è´¥: {e}")
```

**ä½¿ç”¨åœºæ™¯**:
- æ“ä½œå¤±è´¥
- æ•°æ®æå–é”™è¯¯
- ç½‘ç»œé”™è¯¯
- æ–‡ä»¶IOé”™è¯¯

### EXCEPTION - å¼‚å¸¸ä¿¡æ¯
```python
try:
    process_data()
except Exception as e:
    logger.exception("å¤„ç†æ•°æ®æ—¶å‘ç”Ÿå¼‚å¸¸")
```

**ä½¿ç”¨åœºæ™¯**:
- æ•è·çš„å¼‚å¸¸
- éœ€è¦å®Œæ•´å †æ ˆçš„é”™è¯¯
- è°ƒè¯•å¤æ‚é—®é¢˜

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. åˆç†è®¾ç½®æ—¥å¿—çº§åˆ«

**å¼€å‘é˜¶æ®µ**:
```python
setup_logger(console_level=logging.DEBUG)  # çœ‹åˆ°æ‰€æœ‰ä¿¡æ¯
```

**ç”Ÿäº§ç¯å¢ƒ**:
```python
setup_logger(console_level=logging.INFO)   # åªçœ‹é‡è¦ä¿¡æ¯
```

### 2. è®°å½•å…³é”®æ“ä½œ

```python
logger.info("=" * 60)
logger.info("å¼€å§‹çˆ¬å–äº§å“æ•°æ®")
logger.info("=" * 60)

for product in products:
    logger.debug(f"å¤„ç†äº§å“: {product['name']}")
    # ...

logger.info("=" * 60)
logger.info(f"çˆ¬å–å®Œæˆï¼å…± {len(products)} ä¸ªäº§å“")
logger.info("=" * 60)
```

### 3. å¼‚å¸¸å¤„ç†

```python
try:
    result = risky_operation()
    logger.info("æ“ä½œæˆåŠŸ")
except ValueError as e:
    logger.error(f"æ•°å€¼é”™è¯¯: {e}")
except Exception as e:
    logger.exception("æœªé¢„æœŸçš„é”™è¯¯")  # åŒ…å«å †æ ˆ
```

### 4. ä¸Šä¸‹æ–‡ä¿¡æ¯

```python
logger.info(f"[é¡µé¢ {page_num}] å¼€å§‹çˆ¬å–")
logger.debug(f"[äº§å“ {idx}/{total}] æå–æ•°æ®")
logger.error(f"[URL {url}] è¯·æ±‚å¤±è´¥")
```

## ğŸ”§ é…ç½®é€‰é¡¹

### è‡ªå®šä¹‰æ—¥å¿—é…ç½®

```python
from utils.logger import ScraperLogger
import logging

logger_manager = ScraperLogger(
    name="my_scraper",           # æ—¥å¿—è®°å½•å™¨åç§°
    log_dir="my_logs",           # æ—¥å¿—ç›®å½•
    console_level=logging.INFO,  # æ§åˆ¶å°çº§åˆ«
    file_level=logging.DEBUG,    # æ–‡ä»¶çº§åˆ«
    max_bytes=20*1024*1024,      # å•æ–‡ä»¶æœ€å¤§20MB
    backup_count=10,             # ä¿ç•™10ä¸ªå¤‡ä»½
    enable_color=True            # å¯ç”¨é¢œè‰²
)

logger = logger_manager.get_logger()
```

### ç¦ç”¨å½©è‰²è¾“å‡º

```python
setup_logger(enable_color=False)
```

### è°ƒæ•´æ–‡ä»¶å¤§å°

```python
logger_manager = ScraperLogger(
    max_bytes=50*1024*1024,  # 50MB
    backup_count=3           # ä¿ç•™3ä¸ªå¤‡ä»½
)
```

## ğŸ“Š æ—¥å¿—åˆ†æ

### ç»Ÿè®¡é”™è¯¯æ•°é‡
```bash
grep -c "ERROR" logs/scraper.log
```

### æŸ¥çœ‹æœ€å¸¸è§çš„é”™è¯¯
```bash
grep "ERROR" logs/scraper.log | sort | uniq -c | sort -rn
```

### æå–ç‰¹å®šæ—¶é—´æ®µ
```bash
sed -n '/2025-11-15 18:00/,/2025-11-15 19:00/p' logs/scraper.log
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ—¥å¿—æ–‡ä»¶è¿‡å¤§

**è§£å†³æ–¹æ¡ˆ**:
- æ—¥å¿—ä¼šè‡ªåŠ¨è½®è½¬
- é»˜è®¤å•æ–‡ä»¶æœ€å¤§10MB
- è¶…è¿‡ä¼šè‡ªåŠ¨åˆ›å»ºæ–°æ–‡ä»¶

### é—®é¢˜2: æ‰¾ä¸åˆ°æ—¥å¿—

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹logsç›®å½•
ls -lh logs/

# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
python scripts/view_logs.py list
```

### é—®é¢˜3: å½©è‰²ä¸æ˜¾ç¤º

**åŸå› **: ä¸æ”¯æŒANSIé¢œè‰²çš„ç»ˆç«¯

**è§£å†³æ–¹æ¡ˆ**:
```python
setup_logger(enable_color=False)
```

## ğŸ“ ç¤ºä¾‹ï¼šå®Œæ•´çš„çˆ¬è™«æ—¥å¿—

```python
from utils.logger import setup_logger, get_logger
import logging

# è®¾ç½®æ—¥å¿—
setup_logger(console_level=logging.INFO)
logger = get_logger()

# å¼€å§‹çˆ¬è™«
logger.info("=" * 60)
logger.info("Holland & Barrett äº§å“çˆ¬è™«")
logger.info("=" * 60)

try:
    logger.info("åˆå§‹åŒ–æµè§ˆå™¨...")
    driver = init_driver()
    logger.info("âœ“ æµè§ˆå™¨å·²å¯åŠ¨")

    url = "https://example.com"
    logger.info(f"è®¿é—®: {url}")
    driver.get(url)
    logger.info("âœ“ é¡µé¢å·²åŠ è½½")

    products = scrape_products(driver)
    logger.info(f"âœ“ æ‰¾åˆ° {len(products)} ä¸ªäº§å“")

    for idx, product in enumerate(products, 1):
        logger.debug(f"[{idx}/{len(products)}] {product['name']}")

    logger.info("=" * 60)
    logger.info("çˆ¬å–å®Œæˆï¼")
    logger.info("=" * 60)

except KeyboardInterrupt:
    logger.warning("ç”¨æˆ·ä¸­æ–­çˆ¬è™«")
except Exception as e:
    logger.exception("çˆ¬è™«å‘ç”Ÿé”™è¯¯")
finally:
    driver.quit()
    logger.info("æµè§ˆå™¨å·²å…³é—­")
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®ç»“æ„è¯´æ˜](../PROJECT_STRUCTURE.md)
- [å¿«é€Ÿå¯åŠ¨æŒ‡å—](../QUICKSTART.md)
- [å¤šé¡µçˆ¬å–è¯´æ˜](å¤šé¡µçˆ¬å–è¯´æ˜.md)
