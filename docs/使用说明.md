# Holland & Barrett 产品爬虫 - 使用说明

## 🎉 功能概述

这是一个完整的 Holland & Barrett 产品爬虫，可以爬取产品列表页和详情页的所有信息。

### 支持的数据字段

✅ **基本信息**
- 产品名称
- 产品品牌
- 产品价格
- 产品图片

✅ **详细信息**
- 产品亮点 (Benefits)
- 产品描述 (Description)
- 用法服量 (Directions)
- 配料表 (Ingredients)
- 营养成分 (Nutritional Information)

## 📦 环境要求

- Python 3.11+
- uv (Python 包管理器)
- Chrome 浏览器

## 🚀 快速开始

### 1. 运行完整爬虫

```bash
uv run python main.py
```

**运行流程：**
1. 自动打开 Chrome 浏览器
2. 爬取产品列表页（约20个产品）
3. 保存基本信息到 `products_basic.csv`
4. 询问是否继续爬取详情页
5. 如果选择 `y`，会询问要爬取多少个产品
6. 完成后保存完整数据到 `products_complete.csv`

### 2. 测试详情页提取（使用本地HTML文件）

```bash
uv run python test_detail.py
```

这会使用保存的 HTML 文件测试数据提取功能，无需访问网站。

### 3. 单独提取产品信息（使用本地HTML文件）

```bash
uv run python extract_product.py "产品页面.html"
```

## 📊 输出文件

### products_basic.csv
包含基本信息的CSV文件（列表页爬取）
- brand（品牌）
- name（名称）
- price（价格）
- image（图片URL）
- url（详情页URL）

### products_complete.csv
包含完整信息的CSV文件（包含详情页数据）
- 产品名称
- 产品亮点
- 产品价格
- 产品品牌
- 产品图
- 产品描述
- 产品类型
- 作用部位
- 用法服量
- 知识科普
- 营养成分
- 配料表
- URL

## ⚙️ 配置选项

### 修改爬取URL

在 `main.py` 中修改：

```python
list_url = "https://www.hollandandbarrett.com/shop/vitamins-supplements/condition/hair-skin-nails/"
```

可以替换为任何 Holland & Barrett 的产品列表页URL。

### 调整爬取延迟

在 `main.py` 中修改：

```python
time.sleep(2)  # 每个产品之间延迟2秒
```

建议保持至少1-2秒的延迟，避免请求过快。

### 修改浏览器选项

在 `main.py` 的 Chrome 配置中可以添加：

```python
options.add_argument('--headless')  # 无头模式（不显示浏览器窗口）
options.add_argument('--disable-gpu')  # 禁用GPU加速
```

## 🔍 核心技术

### 关键发现
Holland & Barrett 使用 **React SPA 架构**，所有产品数据存储在页面的 JSON 中：

```html
<script id="__LAYOUT__" type="application/json">
```

因此我们的爬虫：
- ✅ 直接解析 JSON 数据（快速、可靠）
- ❌ 不使用 CSS 选择器（容易失效）
- ✅ 无需等待 JavaScript 渲染（高效）

### 数据提取流程

1. **访问页面** → Selenium 加载页面
2. **获取HTML** → `driver.page_source`
3. **正则提取JSON** → 从 `<script id="__LAYOUT__">` 提取
4. **解析数据** → 递归查找产品数据UUID
5. **格式化输出** → 清理HTML标签，组织数据

## 📝 注意事项

### 爬虫礼仪
- ⏰ 合理设置延迟时间（建议2秒）
- 🌙 避免在高峰期大量爬取
- 🚫 不要频繁重复爬取相同内容
- 💾 使用缓存避免重复请求

### Cookie 弹窗
脚本会自动处理 Cookie 弹窗，如果遇到问题：
- 检查网络连接
- 增加等待时间
- 手动在浏览器中接受 Cookie

### 常见问题

**Q: 爬虫卡住不动？**
A: 可能是页面加载慢，尝试增加 `time.sleep()` 时间

**Q: 提取不到数据？**
A: 检查网站结构是否变化，运行 `test_detail.py` 诊断问题

**Q: 某些字段为空？**
A: 部分产品可能没有所有字段（如营养成分），这是正常的

**Q: 想爬取其他类目？**
A: 修改 `list_url` 为其他产品列表页即可

## 🛠️ 项目文件说明

```
hb_scraper/
├── main.py                    # 主爬虫脚本
├── extract_product.py         # 产品数据提取工具
├── test_detail.py             # 测试脚本
├── products_basic.csv         # 基本信息输出
├── products_complete.csv      # 完整信息输出
├── pyproject.toml             # 项目依赖配置
├── uv.lock                    # 锁定依赖版本
└── 使用说明.md                # 本文件
```

## 📚 扩展阅读

- `SUMMARY.md` - 技术实现总结
- `selector_guide.md` - 数据提取详细指南
- `README_SELECTORS.md` - 选择器快速参考

## 🎯 下一步优化建议

1. **多线程爬取** - 使用 `concurrent.futures` 并发爬取
2. **断点续爬** - 保存进度，支持中断后继续
3. **数据库存储** - 将数据存入 SQLite/MySQL
4. **错误重试** - 添加自动重试机制
5. **代理支持** - 添加代理池避免IP限制

## 📞 技术支持

如有问题，请检查：
1. Python 版本是否正确（3.11+）
2. 依赖是否完整安装（`uv sync`）
3. Chrome 浏览器是否正常运行
4. 网络连接是否正常

---

**祝你爬取愉快！** 🎉
